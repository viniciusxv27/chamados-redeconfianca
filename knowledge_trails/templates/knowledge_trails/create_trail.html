{% extends "base.html" %}
{% load static %}

{% block title %}Criar Nova Trilha - Trilhas de Conhecimento{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 p-6">
    <div class="max-w-5xl mx-auto">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 p-6">
                <div class="flex justify-between items-center">
                    <h4 class="text-2xl font-bold text-white mb-0">
                        <i class="fas fa-plus-circle mr-2"></i>
                        Criar Nova Trilha de Conhecimento
                    </h4>
                    <a href="{% url 'knowledge_trails:dashboard' %}" class="px-4 py-2 bg-white text-purple-600 rounded-lg hover:bg-gray-100 transition-all font-semibold">
                        <i class="fas fa-arrow-left mr-1"></i> Voltar
                    </a>
                </div>
            </div>
            <div class="p-8">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Informa√ß√µes B√°sicas -->
                            <div class="lg:col-span-2">
                                <h5 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <i class="fas fa-info-circle text-purple-600 mr-2"></i>
                                    Informa√ß√µes B√°sicas
                                </h5>
                                
                                <div class="mb-4">
                                    <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">
                                        T√≠tulo da Trilha <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" 
                                           id="title" name="title" required maxlength="200"
                                           placeholder="Ex: Introdu√ß√£o ao Sistema">
                                    <p class="mt-1 text-sm text-red-500 hidden invalid-feedback">Por favor, insira um t√≠tulo para a trilha.</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="description" class="block text-sm font-semibold text-gray-700 mb-2">Descri√ß√£o</label>
                                    <textarea class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" 
                                              id="description" name="description" rows="4" 
                                              placeholder="Descreva o objetivo e o conte√∫do da trilha..."></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label for="sector" class="block text-sm font-semibold text-gray-700 mb-2">
                                            Setor <span class="text-red-500">*</span>
                                        </label>
                                        <select class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" 
                                                id="sector" name="sector" required>
                                            <option value="">Selecione um setor</option>
                                            {% for sector in sectors %}
                                            <option value="{{ sector.id }}">{{ sector.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <p class="mt-1 text-sm text-red-500 hidden invalid-feedback">Por favor, selecione um setor.</p>
                                    </div>
                                    
                                    <div>
                                        <label for="difficulty" class="block text-sm font-semibold text-gray-700 mb-2">Dificuldade</label>
                                        <select class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" 
                                                id="difficulty" name="difficulty">
                                            {% for value, label in difficulty_choices %}
                                            <option value="{{ value }}">{{ label }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="estimated_hours" class="block text-sm font-semibold text-gray-700 mb-2">
                                        Tempo Estimado (horas)
                                    </label>
                                    <input type="number" 
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" 
                                           id="estimated_hours" name="estimated_hours" 
                                           value="1" min="1" max="1000">
                                </div>
                            </div>
                            
                            <!-- Gamifica√ß√£o -->
                            <div>
                                <h5 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                    <i class="fas fa-palette text-purple-600 mr-2"></i>
                                    Gamifica√ß√£o
                                </h5>
                                
                                <div class="mb-4">
                                    <label for="icon" class="block text-sm font-semibold text-gray-700 mb-2">√çcone (Emoji)</label>
                                    <input type="text" 
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all text-3xl text-center" 
                                           id="icon" name="icon" value="üìö" maxlength="2">
                                    <p class="mt-1 text-xs text-gray-500">Use um emoji para representar a trilha</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="color" class="block text-sm font-semibold text-gray-700 mb-2">Cor</label>
                                    <input type="color" 
                                           class="w-full h-12 border-2 border-gray-200 rounded-xl cursor-pointer" 
                                           id="color" name="color" value="#6366f1">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" 
                                               class="w-5 h-5 text-purple-600 border-2 border-gray-300 rounded focus:ring-2 focus:ring-purple-200" 
                                               id="enable_certificate" name="enable_certificate" checked>
                                        <span class="ml-2 text-sm font-medium text-gray-700">
                                            <i class="fas fa-certificate text-yellow-500 mr-1"></i>
                                            Emitir Certificado
                                        </span>
                                    </label>
                                </div>
                                
                                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mt-4">
                                    <div class="flex items-start">
                                        <i class="fas fa-info-circle text-blue-600 mt-1 mr-2"></i>
                                        <div>
                                            <p class="text-sm font-semibold text-blue-900">Pr√≥ximo passo:</p>
                                            <p class="text-sm text-blue-700">Ap√≥s criar a trilha, voc√™ poder√° adicionar m√≥dulos e li√ß√µes.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-6 border-gray-200">
                        
                        <div class="flex justify-end gap-3">
                            <a href="{% url 'knowledge_trails:dashboard' %}" 
                               class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all font-semibold">
                                <i class="fas fa-times mr-1"></i> Cancelar
                            </a>
                            <button type="submit" 
                                    class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all font-semibold shadow-lg hover:shadow-xl">
                                <i class="fas fa-save mr-1"></i> Criar Trilha
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation with Tailwind
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.needs-validation');
    
    form.addEventListener('submit', function(event) {
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            const feedback = field.parentElement.querySelector('.invalid-feedback');
            
            if (!field.value || field.value === '') {
                isValid = false;
                field.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-200');
                field.classList.remove('border-gray-200', 'focus:border-purple-500', 'focus:ring-purple-200');
                if (feedback) feedback.classList.remove('hidden');
            } else {
                field.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-200');
                field.classList.add('border-gray-200', 'focus:border-purple-500', 'focus:ring-purple-200');
                if (feedback) feedback.classList.add('hidden');
            }
        });
        
        if (!isValid) {
            event.preventDefault();
            event.stopPropagation();
        }
    });
    
    // Real-time validation
    form.querySelectorAll('[required]').forEach(field => {
        field.addEventListener('input', function() {
            const feedback = this.parentElement.querySelector('.invalid-feedback');
            
            if (this.value && this.value !== '') {
                this.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-200');
                this.classList.add('border-gray-200', 'focus:border-purple-500', 'focus:ring-purple-200');
                if (feedback) feedback.classList.add('hidden');
            }
        });
    });
});
</script>
{% endblock %}
