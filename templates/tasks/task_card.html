{% load static %}

<div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 border-l-4 {% if task.status == 'PENDING' %}border-yellow-500{% elif task.status == 'DOING' %}border-blue-500{% elif task.status == 'DONE' %}border-green-500{% endif %} {% if is_overdue %}bg-red-50{% endif %} cursor-pointer h-full"
     onclick="openTaskModal({{ task.id }}, '{{ task.title|escapejs }}', '{{ task.description|default:''|escapejs }}', '{{ task.status }}')">
    
    <div class="p-6 flex flex-col h-full">
        <!-- Header com título e prioridade -->
        <div class="flex justify-between items-start mb-3">
            <h3 class="font-semibold text-lg text-gray-900 line-clamp-2 flex-1">{{ task.title }}</h3>
            <div class="flex items-center ml-3">
                {% if task.priority %}
                <i class="fas fa-flag mr-2 
                         {% if task.priority == 'HIGH' %}text-red-500
                         {% elif task.priority == 'MEDIUM' %}text-yellow-500
                         {% elif task.priority == 'LOW' %}text-green-500
                         {% endif %}" 
                   title="Prioridade: {{ task.get_priority_display }}"></i>
                {% endif %}
                {% if is_overdue %}
                <span class="bg-red-500 text-white text-xs font-medium px-2 py-1 rounded-full ml-1">
                    <i class="fas fa-exclamation-triangle mr-1"></i>Atrasado
                </span>
                {% endif %}
            </div>
        </div>

        <!-- Descrição -->
        {% if task.description %}
        <p class="text-gray-600 text-sm mb-3 line-clamp-3">{{ task.description|truncatechars:80 }}</p>
        {% endif %}

        <!-- Status Badge -->
        <div class="mb-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                       {% if task.status == 'PENDING' %}bg-yellow-100 text-yellow-800
                       {% elif task.status == 'DOING' %}bg-blue-100 text-blue-800  
                       {% elif task.status == 'DONE' %}bg-green-100 text-green-800
                       {% endif %}">
                {% if task.status == 'PENDING' %}
                    <i class="fas fa-clock mr-1"></i>Pendente
                {% elif task.status == 'DOING' %}
                    <i class="fas fa-play mr-1"></i>Em Andamento
                {% elif task.status == 'DONE' %}
                    <i class="fas fa-check mr-1"></i>Concluída
                {% endif %}
            </span>
        </div>

        <!-- Informações de data -->
        <div class="text-sm text-gray-600 space-y-2 flex-1">
            {% if task.due_date %}
            <div class="flex items-center">
                <i class="fas fa-calendar-alt mr-2 w-4"></i> 
                <span>Prazo: {{ task.due_date|date:"d/m/Y H:i" }}</span>
                {% if is_overdue %}
                    <span class="text-red-600 font-semibold ml-2">
                        ({{ task.due_date|timesince }} atrás)
                    </span>
                {% else %}
                    <span class="text-gray-500 ml-2">
                        (em {{ task.due_date|timeuntil }})
                    </span>
                {% endif %}
            </div>
            {% endif %}

            {% if task.created_by %}
            <div class="flex items-center">
                <i class="fas fa-user mr-2 w-4"></i> 
                <span>Criado por: {{ task.created_by.get_full_name|default:task.created_by.username }}</span>
            </div>
            {% endif %}

            <div class="flex items-center">
                <i class="fas fa-clock mr-2 w-4"></i> 
                <span>Criado: {{ task.created_at|date:"d/m/Y H:i" }}</span>
            </div>

            {% if task.status == 'DONE' and task.completed_at %}
            <div class="flex items-center text-green-600">
                <i class="fas fa-check-circle mr-2 w-4"></i> 
                <span>Concluído: {{ task.completed_at|date:"d/m/Y H:i" }}</span>
            </div>
            {% endif %}
        </div>

        <!-- Footer com ação -->
        <div class="mt-4 pt-4 border-t border-gray-100">
            <div class="flex justify-between items-center">
                {% if task.priority %}
                <div class="text-sm text-gray-600">
                    <i class="fas fa-flag mr-1
                             {% if task.priority == 'HIGH' %}text-red-500
                             {% elif task.priority == 'MEDIUM' %}text-yellow-500
                             {% elif task.priority == 'LOW' %}text-green-500
                             {% endif %}"></i>
                    {{ task.get_priority_display }}
                </div>
                {% else %}
                <span></span>
                {% endif %}
                
                <div class="text-primary font-medium text-sm">
                    <i class="fas fa-edit mr-1"></i>Clique para editar
                </div>
            </div>
        </div>
    </div>
</div>