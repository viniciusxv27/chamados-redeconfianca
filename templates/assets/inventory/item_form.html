{% extends 'base.html' %}

{% block title %}{% if item %}Editar Item{% else %}Novo Item{% endif %} - Inventário{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-4 sm:py-6 px-4 sm:px-0">
    <!-- Header -->
    <div class="mb-6">
        <nav class="flex mb-4" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'assets:inventory_dashboard' %}" class="text-sm text-gray-500 hover:text-indigo-600">
                        <i class="fas fa-warehouse mr-1"></i> Inventário
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                        <a href="{% url 'assets:item_list' %}" class="text-sm text-gray-500 hover:text-indigo-600">Itens</a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                        <span class="text-sm text-gray-700">{% if item %}Editar{% else %}Novo{% endif %}</span>
                    </div>
                </li>
            </ol>
        </nav>

        <h2 class="text-2xl font-bold text-gray-900">
            {% if item %}
            <i class="fas fa-edit text-indigo-600 mr-2"></i>
            Editar Item - {{ item.inventory_number }}
            {% else %}
            <i class="fas fa-plus-circle text-indigo-600 mr-2"></i>
            Novo Item de Inventário
            {% endif %}
        </h2>
        <p class="mt-1 text-sm text-gray-500">
            {% if item %}Atualize as informações do item{% else %}Cadastre um novo item unitário no inventário{% endif %}
        </p>
    </div>

    <!-- Form -->
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <!-- Produto e Identificação -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-barcode text-indigo-600 mr-2"></i>
                    Produto e Identificação
                </h3>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="id_product" class="block text-sm font-medium text-gray-700 mb-1">
                            Produto <span class="text-red-500">*</span>
                        </label>
                        <select name="product" id="id_product" required
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 {% if form.product.errors %}border-red-500{% endif %}">
                            <option value="">Selecione um produto</option>
                            {% for product in form.fields.product.queryset %}
                            <option value="{{ product.pk }}" {% if form.product.value == product.pk|stringformat:"s" or item and item.product_id == product.pk %}selected{% endif %}>
                                {{ product.sku }} - {{ product.name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if form.product.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.product.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_inventory_number" class="block text-sm font-medium text-gray-700 mb-1">
                            Número de Inventário <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="inventory_number" id="id_inventory_number" 
                               value="{{ form.inventory_number.value|default:'' }}" required
                               placeholder="INV-2024-0001"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 {% if form.inventory_number.errors %}border-red-500{% endif %}">
                        {% if form.inventory_number.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.inventory_number.errors|join:", " }}</p>
                        {% endif %}
                        <p class="mt-1 text-xs text-gray-500">Código único para identificar este item específico</p>
                    </div>
                    
                    <div>
                        <label for="id_serial_number" class="block text-sm font-medium text-gray-700 mb-1">
                            Número de Série
                        </label>
                        <input type="text" name="serial_number" id="id_serial_number" 
                               value="{{ form.serial_number.value|default:'' }}"
                               placeholder="SN123456789"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        {% if form.serial_number.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.serial_number.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_batch_number" class="block text-sm font-medium text-gray-700 mb-1">
                            Número do Lote
                        </label>
                        <input type="text" name="batch_number" id="id_batch_number" 
                               value="{{ form.batch_number.value|default:'' }}"
                               placeholder="LOTE-2024-01"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        {% if form.batch_number.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.batch_number.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Status e Condição -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-clipboard-check text-indigo-600 mr-2"></i>
                    Status e Condição
                </h3>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="id_status" class="block text-sm font-medium text-gray-700 mb-1">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select name="status" id="id_status" required
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            {% for value, label in form.fields.status.choices %}
                            <option value="{{ value }}" {% if form.status.value == value or item and item.status == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.status.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.status.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_condition" class="block text-sm font-medium text-gray-700 mb-1">
                            Condição <span class="text-red-500">*</span>
                        </label>
                        <select name="condition" id="id_condition" required
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            {% for value, label in form.fields.condition.choices %}
                            <option value="{{ value }}" {% if form.condition.value == value or item and item.condition == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.condition.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.condition.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_location" class="block text-sm font-medium text-gray-700 mb-1">
                            Localização
                        </label>
                        <input type="text" name="location" id="id_location" 
                               value="{{ form.location.value|default:'' }}"
                               placeholder="Almoxarifado, Prateleira A3"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        {% if form.location.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.location.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Atribuição -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-user-tag text-indigo-600 mr-2"></i>
                    Atribuição
                </h3>
                <p class="mt-1 text-sm text-gray-500">Opcional: defina a quem ou a qual setor este item está atribuído</p>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="id_assigned_to" class="block text-sm font-medium text-gray-700 mb-1">
                            Atribuído a (Usuário)
                        </label>
                        <select name="assigned_to" id="id_assigned_to"
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Nenhum</option>
                            {% for user in form.fields.assigned_to.queryset %}
                            <option value="{{ user.pk }}" {% if form.assigned_to.value == user.pk|stringformat:"s" or item and item.assigned_to_id == user.pk %}selected{% endif %}>
                                {{ user.get_full_name|default:user.email }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if form.assigned_to.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.assigned_to.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_assigned_sector" class="block text-sm font-medium text-gray-700 mb-1">
                            Atribuído a (Setor)
                        </label>
                        <select name="assigned_sector" id="id_assigned_sector"
                                class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Nenhum</option>
                            {% for sector in form.fields.assigned_sector.queryset %}
                            <option value="{{ sector.pk }}" {% if form.assigned_sector.value == sector.pk|stringformat:"s" or item and item.assigned_sector_id == sector.pk %}selected{% endif %}>
                                {{ sector.name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if form.assigned_sector.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.assigned_sector.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Informações de Compra -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-shopping-cart text-indigo-600 mr-2"></i>
                    Informações de Compra
                </h3>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="id_purchase_date" class="block text-sm font-medium text-gray-700 mb-1">
                            Data de Compra
                        </label>
                        <input type="date" name="purchase_date" id="id_purchase_date" 
                               value="{{ form.purchase_date.value|date:'Y-m-d'|default:'' }}"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        {% if form.purchase_date.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.purchase_date.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_purchase_price" class="block text-sm font-medium text-gray-700 mb-1">
                            Preço de Compra
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">R$</span>
                            <input type="number" step="0.01" min="0" name="purchase_price" id="id_purchase_price" 
                                   value="{{ form.purchase_price.value|default:'' }}"
                                   placeholder="0,00"
                                   class="w-full pl-10 border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        {% if form.purchase_price.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.purchase_price.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_warranty_expiry" class="block text-sm font-medium text-gray-700 mb-1">
                            Garantia até
                        </label>
                        <input type="date" name="warranty_expiry" id="id_warranty_expiry" 
                               value="{{ form.warranty_expiry.value|date:'Y-m-d'|default:'' }}"
                               class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        {% if form.warranty_expiry.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.warranty_expiry.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Foto e Observações -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    <i class="fas fa-image text-indigo-600 mr-2"></i>
                    Foto e Observações
                </h3>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="id_photo" class="block text-sm font-medium text-gray-700 mb-1">
                            Foto do Item
                        </label>
                        {% if item and item.photo %}
                        <div class="mb-3">
                            <img src="{{ item.photo.url }}" alt="Foto atual" class="h-32 w-32 object-cover rounded-lg">
                            <p class="text-xs text-gray-500 mt-1">Foto atual</p>
                        </div>
                        {% endif %}
                        <input type="file" name="photo" id="id_photo" accept="image/*"
                               class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                        {% if form.photo.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.photo.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_notes" class="block text-sm font-medium text-gray-700 mb-1">
                            Observações
                        </label>
                        <textarea name="notes" id="id_notes" rows="5"
                                  placeholder="Observações adicionais sobre este item..."
                                  class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">{{ form.notes.value|default:'' }}</textarea>
                        {% if form.notes.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.notes.errors|join:", " }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Botões -->
        <div class="flex justify-end space-x-4">
            <a href="{% url 'assets:item_list' %}" 
               class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                Cancelar
            </a>
            <button type="submit" 
                    class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                <i class="fas fa-save mr-2"></i>
                {% if item %}Salvar Alterações{% else %}Cadastrar Item{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
